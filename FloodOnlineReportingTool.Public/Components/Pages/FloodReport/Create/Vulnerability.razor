@page "/floodreport/create/vulnerability"
@using FloodOnlineReportingTool.Database.Models
@using FloodOnlineReportingTool.Database.Models.Status
@using FloodOnlineReportingTool.Public.Components.Pagination

<PageTitle>@Title</PageTitle>

<GdsBreadcrumbs Items="Breadcrumbs" />

<h1 class="govuk-heading-xl">@Title</h1>

<EditForm EditContext="_editContext" FormName="Vulnerability">
    <FluentValidationValidator />
    <GdsErrorSummary />

    <GdsSpinner Show="_isLoading" ShowMessage="true" />

    <p class="govuk-body">We would like to understand if people affected by this flooding required additional help.</p>
    <details class="govuk-details">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text">Who is included as vulnerable?</span>
        </summary>
        <div class="govuk-details__text">
            <p class="govuk-body"> Those who are vulnerable will vary but include:</p>
            <ul class="govuk-list govuk-list--bullet govuk-list--spaced">
                <li>those with mobility difficulties (e.g. those with physical disabilities or pregnant women);</li>
                <li>those with mental health difficulties;</li>
                <li>those in receipt of social and/or medical care in their own homes</li>
            </ul>
        </div>
    </details>

    @if (!_isLoading && _vulnerableOptions.Count <= 0)
    {
        <p class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> <span>The vulnerable options are missing, please refresh and try again. If this message continues to appear please raise a bug report.</span>
        </p>
    }

    <GdsFormGroup For="() => Model.VulnerablePeopleId" Show="!_isLoading">
        <InputRadioGroup @bind-Value="Model.VulnerablePeopleId">
            <GdsFieldsetGroup>
                <Heading>
                    <h2 class="govuk-fieldset__heading">Are there any vulnerable people at the property?</h2>
                </Heading>
                <Content>
                    <GdsErrorMessage />

                    <div class="govuk-radios" data-module="govuk-radios">
                        @foreach (var option in _vulnerableOptions)
                        {
                            var conditionalId = option.Value == RecordStatusIds.Yes ? "conditional-known" : null;
                            <GdsRadio Option="option" ConditionalId="@conditionalId" />
                            if (conditionalId != null)
                            {
                                <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="@conditionalId">
                                    <GdsFormGroup For="() => Model.VulnerablePeopleText">
                                        <GdsLabel Text="How many people are vulnerable?" />
                                        <GdsErrorMessage />
                                        <GdsInputNumber @bind-Value="Model.VulnerablePeopleText" @bind-NumberValue="Model.VulnerablePeopleNumber" class="govuk-input govuk-input--width-4" />
                                    </GdsFormGroup>
                                </div>
                            }
                        }
                    </div>
                </Content>
            </GdsFieldsetGroup>
        </InputRadioGroup>
    </GdsFormGroup>

    @if (!_isLoading)
    {
        <PaginationBlock>
            <PaginationNext OnNextPage="() => OnValidSubmit(true)" Label="@FloodReportCreatePages.FloodStarted.Title" />
            <PaginationPrevious OnPreviousPage="() => OnValidSubmit(false)" Label="@GetPreviousPageTitle()" />
        </PaginationBlock>
    }

</EditForm>
